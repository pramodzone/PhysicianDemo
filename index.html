<!DOCTYPE html>
<html>

<head>
    <title>FHIR Physician browser sample app</title>
    <script src="https://secure.aadcdn.microsoftonline-p.com/lib/1.0.0/js/msal.js"></script></head>

<body>
    <div class="leftContainer">
        <p id="WelcomeMessage">Welcome to the FHIR Physician browsing sample Application</p>
        <button id="SignIn" onclick="signIn()">Sign In</button>
    </div>

    <div id="patientTable">
    </div>

    <script>
        var msalConfig = {
            auth: {
                clientId: '8fd52680-9d4d-4d80-be79-b2229e4e2ae3',
                authority: "https://login.microsoftonline.com/666970e6-6b32-4d51-9b11-00684bacff6d"
            },
            cache: {
                cacheLocation: "localStorage",
                storeAuthStateInCookie: true
            }
        }

        var FHIRConfig = {
            FHIRendpoint: "https://azurehealthdemo.azurehealthcareapis.com"
        }
        var requestObj = {
            scopes: ["https://azurehealthdemo.azurehealthcareapis.com/user_impersonation"]
        }

        function authRedirectCallBack(error, response) {
            if (error) {
                console.log(error);
            } else {
                if (response.tokenType === "access_token") {
                    callFHIRServer(FHIRConfig.FHIRendpoint + '/Patient', 'GET', null, response.accessToken, FHIRCallback);
                }
            }
        }

        var myMSALObj = new Msal.UserAgentApplication(msalConfig);
        myMSALObj.handleRedirectCallback(authRedirectCallBack);

        function signIn() {
            myMSALObj.loginPopup(requestObj).then(function (loginResponse) {
                acquireTokenPopupAndCallFHIRServer();
            }).catch(function (error) {
                console.log(error);
            })
        }
        function signOut() {
            myMSALObj.logout();
        }

        function acquireTokenPopupAndCallFHIRServer() {
            myMSALObj.acquireTokenSilent(requestObj).then(function (tokenResponse) {
			sessionStorage.setItem("ApiToken", 'Bearer ' + accessToken);
			alert('pramod1 - '+ sessionStorage.getItem("ApiToken"));			
			location.href = location.origin+'/PhysicianDemo/Dashboard.html';
            }).catch(function (error) {
                alert('Error - ' +error);
            });
        }
    </script>
</body>

</html>